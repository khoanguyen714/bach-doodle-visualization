<html>
  <head>
    <title>icicle</title>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.8.0"></script>
    <script src="common.js"></script>
    <link href="style.css" rel="stylesheet">
  </head>
  <body>
    slow to load, hover to inspect, click to play
    <div id="legend"></div>
    <svg id="svg"></svg>
    <div class="tooltip" id="tooltip" hidden>
      <span id="seqText"></span>: <b id="valueText"></b> times<br>
      <svg id="visualizer"></svg>
    </div>
  </body>
  <script>
    d3.json('/data/top_2000.json').then(showData);

    function showData(data) {
      loadAllSamples();

      // https://observablehq.com/@d3/icicle
      const height = window.innerHeight - 100;
      const width = window.innerWidth - 100;

      const partition = data => d3.partition()
          .size([height, width])
          .padding(1)  // between cells
          (d3.hierarchy(data)
            .sum(d => d.value)
            .sort((a, b) => b.height - a.height || b.value - a.value))
      
      const root = partition(data);

      const svg = d3.select('#svg')
          .attr('width', width)
          .attr('height', height)

      const cell = svg
          .selectAll('g')
          .data(root.descendants())
          .join('g')
          .attr('transform', d => `translate(${d.y0},${d.x0})`);

      cell.append('rect')
          .attr('width', d => !d.depth ? 0 : d.y1 - d.y0)
          .attr('height', d => !d.depth ? 0 : d.x1 - d.x0)
          .attr('fill', fill)
          .attr('fill-opacity', ZOOM_OPACITY)
          .on('click', handleClick)
          .on('mouseover', handleMouseOver)
          .on('mouseout', handleMouseOut);

      svg.node();
      
      const el = document.getElementById('svg');
      const box = el.getBBox();
      el.setAttribute('viewBox', `${box.x} ${box.y} ${box.width} ${box.height}`);
    }
</script>
</html>


